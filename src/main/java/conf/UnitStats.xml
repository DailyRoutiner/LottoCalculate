<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="UNITSTATS">
	<resultMap id="UnitStatsResultMap" type="UnitStatsDTO">
		<result property="unitId" column="UNIT_ID" />
		<result property="unitNumber" column="UNIT_NUMBER" />
		<result property="unitFrequency" column="UNIT_FREQUENCY" />
	</resultMap>

	<select id="unitPriority" resultMap="UnitStatsResultMap">
		SELECT UNIT_ID , RATIO
		FROM (SELECT UNIT_ID, (CASE  UNIT_ID
								WHEN 'A' THEN UNIT_FREQUENCY * (10/9)
								WHEN 'E' THEN UNIT_FREQUENCY * (10/6)
							    ELSE UNIT_FREQUENCY
							    END) RATIO
			  FROM UNIT_STATS
			  ORDER BY RATIO ASC)
		WHERE 3 >= ROWNUM
	</select>

	<update id="updateUnitFrequency" parameterType="String">
		UPDATE UNIT_STATS
		SET UNIT_FREQUENCY = ( SELECT sum(NUMERAL_FREQUENCY)
								FROM NUMERAL_STATS
								WHERE UNIT_ID_FK = #{unitId} )
		WHERE UNIT_ID = #{unitId}
	</update>

</mapper>